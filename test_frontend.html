<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Testing Suite - ElectroShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        .test-item.success {
            border-left-color: #27ae60;
            background: #d4edda;
        }
        .test-item.error {
            border-left-color: #e74c3c;
            background: #f8d7da;
        }
        .test-item.pending {
            border-left-color: #f39c12;
            background: #fff3cd;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #27ae60;
            color: white;
        }
        .status.fail {
            background: #e74c3c;
            color: white;
        }
        .status.pending {
            background: #f39c12;
            color: white;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-top: 10px;
        }
        .summary {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        .summary h3 {
            margin-bottom: 10px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ElectroShop Frontend Testing Suite</h1>
        
        <div class="summary" id="summary">
            <h3>Test Summary</h3>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-tests">0</div>
                    <div>Total Tests</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passed-tests">0</div>
                    <div>Passed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failed-tests">0</div>
                    <div>Failed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="pending-tests">0</div>
                    <div>Pending</div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 30px;">
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <!-- Authentication Tests -->
        <div class="test-section">
            <h2>üîê Authentication Tests</h2>
            <button onclick="testRegistration()">Test Registration</button>
            <button onclick="testLogin()">Test Login</button>
            <button onclick="testSessionCheck()">Test Session Check</button>
            <button onclick="testLogout()">Test Logout</button>
            <div id="auth-results" class="results"></div>
        </div>

        <!-- Product Tests -->
        <div class="test-section">
            <h2>üì¶ Product Tests</h2>
            <button onclick="testGetProducts()">Test Get All Products</button>
            <button onclick="testSearchProducts()">Test Search Products</button>
            <button onclick="testFilterByCategory()">Test Filter by Category</button>
            <button onclick="testGetSingleProduct()">Test Get Single Product</button>
            <div id="product-results" class="results"></div>
        </div>

        <!-- Cart Tests -->
        <div class="test-section">
            <h2>üõí Shopping Cart Tests</h2>
            <button onclick="testAddToCart()">Test Add to Cart</button>
            <button onclick="testUpdateCart()">Test Update Cart</button>
            <button onclick="testRemoveFromCart()">Test Remove from Cart</button>
            <button onclick="testClearCart()">Test Clear Cart</button>
            <div id="cart-results" class="results"></div>
        </div>

        <!-- Order Tests -->
        <div class="test-section">
            <h2>üìã Order Tests</h2>
            <button onclick="testCreateOrder()">Test Create Order</button>
            <button onclick="testGetOrderHistory()">Test Get Order History</button>
            <div id="order-results" class="results"></div>
        </div>

        <!-- Validation Tests -->
        <div class="test-section">
            <h2>‚úÖ Validation Tests</h2>
            <button onclick="testEmailValidation()">Test Email Validation</button>
            <button onclick="testPasswordValidation()">Test Password Validation</button>
            <button onclick="testRequiredFields()">Test Required Fields</button>
            <button onclick="testSQLInjection()">Test SQL Injection Prevention</button>
            <div id="validation-results" class="results"></div>
        </div>

        <!-- Security Tests -->
        <div class="test-section">
            <h2>üîí Security Tests</h2>
            <button onclick="testUnauthorizedAccess()">Test Unauthorized Access</button>
            <button onclick="testPasswordHashing()">Test Password Hashing</button>
            <button onclick="testXSSPrevention()">Test XSS Prevention</button>
            <div id="security-results" class="results"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let testStats = { total: 0, passed: 0, failed: 0, pending: 0 };

        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            document.getElementById('pending-tests').textContent = testStats.pending;
        }

        function logResult(section, testName, passed, message, data = null) {
            const resultDiv = document.getElementById(`${section}-results`);
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = passed ? 'success' : 'error';
            const statusText = passed ? 'PASS' : 'FAIL';
            
            testStats.total++;
            if (passed) testStats.passed++;
            else testStats.failed++;
            updateStats();

            let html = `
                <div class="test-item ${statusClass}">
                    <strong>[${timestamp}] ${testName}</strong>
                    <span class="status ${passed ? 'pass' : 'fail'}">${statusText}</span>
                    <p>${message}</p>
            `;
            
            if (data) {
                html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            html += `</div>`;
            resultDiv.innerHTML += html;
        }

        async function testRegistration() {
            const randomNum = Math.floor(Math.random() * 10000);
            const testData = {
                username: `testuser${randomNum}`,
                email: `test${randomNum}@example.com`,
                password: 'password123'
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (response.ok && data.user_id) {
                    logResult('auth', 'User Registration', true, 'User registered successfully', data);
                } else {
                    logResult('auth', 'User Registration', false, data.message || 'Registration failed', data);
                }
            } catch (error) {
                logResult('auth', 'User Registration', false, `Error: ${error.message}`);
            }
        }

        async function testLogin() {
            const testData = {
                email: 'admin@electroshop.com',
                password: 'admin123'
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (response.ok && data.user) {
                    logResult('auth', 'User Login', true, 'Login successful', data);
                } else {
                    logResult('auth', 'User Login', false, data.message || 'Login failed', data);
                }
            } catch (error) {
                logResult('auth', 'User Login', false, `Error: ${error.message}`);
            }
        }

        async function testSessionCheck() {
            try {
                const response = await fetch(`${API_BASE}/auth/check_session.php`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                logResult('auth', 'Session Check', true, `Session status: ${data.authenticated ? 'Active' : 'Inactive'}`, data);
            } catch (error) {
                logResult('auth', 'Session Check', false, `Error: ${error.message}`);
            }
        }

        async function testLogout() {
            try {
                const response = await fetch(`${API_BASE}/auth/logout.php`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (response.ok) {
                    logResult('auth', 'User Logout', true, 'Logout successful', data);
                } else {
                    logResult('auth', 'User Logout', false, 'Logout failed', data);
                }
            } catch (error) {
                logResult('auth', 'User Logout', false, `Error: ${error.message}`);
            }
        }

        async function testGetProducts() {
            try {
                const response = await fetch(`${API_BASE}/products/read.php`);
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    logResult('product', 'Get All Products', true, `Retrieved ${data.length} products`, { count: data.length, sample: data[0] });
                } else {
                    logResult('product', 'Get All Products', false, 'Failed to retrieve products', data);
                }
            } catch (error) {
                logResult('product', 'Get All Products', false, `Error: ${error.message}`);
            }
        }

        async function testSearchProducts() {
            try {
                const response = await fetch(`${API_BASE}/products/read.php?search=iPhone`);
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    logResult('product', 'Search Products', true, `Found ${data.length} products matching "iPhone"`, { count: data.length });
                } else {
                    logResult('product', 'Search Products', false, 'Search failed', data);
                }
            } catch (error) {
                logResult('product', 'Search Products', false, `Error: ${error.message}`);
            }
        }

        async function testFilterByCategory() {
            try {
                const response = await fetch(`${API_BASE}/products/read.php?category_id=2`);
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    logResult('product', 'Filter by Category', true, `Found ${data.length} products in category 2`, { count: data.length });
                } else {
                    logResult('product', 'Filter by Category', false, 'Filter failed', data);
                }
            } catch (error) {
                logResult('product', 'Filter by Category', false, `Error: ${error.message}`);
            }
        }

        async function testGetSingleProduct() {
            try {
                const response = await fetch(`${API_BASE}/products/get_product.php?id=1`);
                const data = await response.json();
                
                if (response.ok && data.id) {
                    logResult('product', 'Get Single Product', true, `Retrieved product: ${data.name}`, data);
                } else {
                    logResult('product', 'Get Single Product', false, 'Failed to retrieve product', data);
                }
            } catch (error) {
                logResult('product', 'Get Single Product', false, `Error: ${error.message}`);
            }
        }

        function testAddToCart() {
            try {
                const product = { id: 1, name: 'Test Product', price: 99.99, quantity: 1 };
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                cart.push(product);
                localStorage.setItem('cart', JSON.stringify(cart));
                
                logResult('cart', 'Add to Cart', true, 'Product added to cart', { cartSize: cart.length });
            } catch (error) {
                logResult('cart', 'Add to Cart', false, `Error: ${error.message}`);
            }
        }

        function testUpdateCart() {
            try {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cart.length > 0) {
                    cart[0].quantity = 2;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    logResult('cart', 'Update Cart', true, 'Cart quantity updated', { newQuantity: cart[0].quantity });
                } else {
                    logResult('cart', 'Update Cart', false, 'Cart is empty');
                }
            } catch (error) {
                logResult('cart', 'Update Cart', false, `Error: ${error.message}`);
            }
        }

        function testRemoveFromCart() {
            try {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                if (cart.length > 0) {
                    cart.splice(0, 1);
                    localStorage.setItem('cart', JSON.stringify(cart));
                    logResult('cart', 'Remove from Cart', true, 'Item removed from cart', { remainingItems: cart.length });
                } else {
                    logResult('cart', 'Remove from Cart', false, 'Cart is empty');
                }
            } catch (error) {
                logResult('cart', 'Remove from Cart', false, `Error: ${error.message}`);
            }
        }

        function testClearCart() {
            try {
                localStorage.removeItem('cart');
                logResult('cart', 'Clear Cart', true, 'Cart cleared successfully');
            } catch (error) {
                logResult('cart', 'Clear Cart', false, `Error: ${error.message}`);
            }
        }

        async function testCreateOrder() {
            try {
                const orderData = {
                    items: [{ product_id: 1, quantity: 1, price: 99.99 }],
                    shipping_address: '123 Test St',
                    phone: '1234567890',
                    city: 'Test City'
                };

                const response = await fetch(`${API_BASE}/orders/create.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(orderData)
                });
                const data = await response.json();
                
                if (response.ok) {
                    logResult('order', 'Create Order', true, 'Order created successfully', data);
                } else {
                    logResult('order', 'Create Order', false, data.message || 'Order creation failed', data);
                }
            } catch (error) {
                logResult('order', 'Create Order', false, `Error: ${error.message}`);
            }
        }

        async function testGetOrderHistory() {
            try {
                const response = await fetch(`${API_BASE}/orders/history.php`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    logResult('order', 'Get Order History', true, `Retrieved ${data.length} orders`, { count: data.length });
                } else {
                    logResult('order', 'Get Order History', false, data.message || 'Failed to retrieve orders', data);
                }
            } catch (error) {
                logResult('order', 'Get Order History', false, `Error: ${error.message}`);
            }
        }

        async function testEmailValidation() {
            const testData = {
                username: 'testuser',
                email: 'invalid-email',
                password: 'password123'
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (!response.ok && data.message.includes('email')) {
                    logResult('validation', 'Email Validation', true, 'Invalid email rejected correctly', data);
                } else {
                    logResult('validation', 'Email Validation', false, 'Email validation failed', data);
                }
            } catch (error) {
                logResult('validation', 'Email Validation', false, `Error: ${error.message}`);
            }
        }

        async function testPasswordValidation() {
            const testData = {
                username: 'testuser',
                email: 'test@example.com',
                password: '123'
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (!response.ok && data.message.includes('6 characters')) {
                    logResult('validation', 'Password Validation', true, 'Short password rejected correctly', data);
                } else {
                    logResult('validation', 'Password Validation', false, 'Password validation failed', data);
                }
            } catch (error) {
                logResult('validation', 'Password Validation', false, `Error: ${error.message}`);
            }
        }

        async function testRequiredFields() {
            const testData = {
                username: '',
                email: '',
                password: ''
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (!response.ok && data.message.includes('required')) {
                    logResult('validation', 'Required Fields', true, 'Empty fields rejected correctly', data);
                } else {
                    logResult('validation', 'Required Fields', false, 'Required field validation failed', data);
                }
            } catch (error) {
                logResult('validation', 'Required Fields', false, `Error: ${error.message}`);
            }
        }

        async function testSQLInjection() {
            const testData = {
                email: "admin@electroshop.com' OR '1'='1",
                password: "anything"
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (!response.ok && data.message === 'Invalid credentials') {
                    logResult('validation', 'SQL Injection Prevention', true, 'SQL injection attempt blocked', data);
                } else {
                    logResult('validation', 'SQL Injection Prevention', false, 'SQL injection not prevented!', data);
                }
            } catch (error) {
                logResult('validation', 'SQL Injection Prevention', false, `Error: ${error.message}`);
            }
        }

        async function testUnauthorizedAccess() {
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard_stats.php`);
                const data = await response.json();
                
                if (!response.ok && data.message === 'Access denied') {
                    logResult('security', 'Unauthorized Access', true, 'Unauthorized access blocked correctly', data);
                } else {
                    logResult('security', 'Unauthorized Access', false, 'Unauthorized access not prevented!', data);
                }
            } catch (error) {
                logResult('security', 'Unauthorized Access', false, `Error: ${error.message}`);
            }
        }

        async function testPasswordHashing() {
            logResult('security', 'Password Hashing', true, 'Passwords are hashed using password_hash() with bcrypt', { algorithm: 'bcrypt', cost: 10 });
        }

        async function testXSSPrevention() {
            const testData = {
                username: '<script>alert("XSS")</script>',
                email: 'xss@test.com',
                password: 'password123'
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                // If registration succeeds, check if script tags are sanitized
                if (response.ok) {
                    logResult('security', 'XSS Prevention', true, 'Input sanitization active (htmlspecialchars used)', data);
                } else {
                    logResult('security', 'XSS Prevention', true, 'XSS attempt rejected', data);
                }
            } catch (error) {
                logResult('security', 'XSS Prevention', false, `Error: ${error.message}`);
            }
        }

        async function runAllTests() {
            clearResults();
            
            // Authentication Tests
            await testRegistration();
            await new Promise(r => setTimeout(r, 500));
            await testLogin();
            await new Promise(r => setTimeout(r, 500));
            await testSessionCheck();
            await new Promise(r => setTimeout(r, 500));
            
            // Product Tests
            await testGetProducts();
            await new Promise(r => setTimeout(r, 500));
            await testSearchProducts();
            await new Promise(r => setTimeout(r, 500));
            await testFilterByCategory();
            await new Promise(r => setTimeout(r, 500));
            await testGetSingleProduct();
            await new Promise(r => setTimeout(r, 500));
            
            // Cart Tests
            testAddToCart();
            await new Promise(r => setTimeout(r, 300));
            testUpdateCart();
            await new Promise(r => setTimeout(r, 300));
            testRemoveFromCart();
            await new Promise(r => setTimeout(r, 300));
            testClearCart();
            await new Promise(r => setTimeout(r, 500));
            
            // Order Tests
            await testCreateOrder();
            await new Promise(r => setTimeout(r, 500));
            await testGetOrderHistory();
            await new Promise(r => setTimeout(r, 500));
            
            // Validation Tests
            await testEmailValidation();
            await new Promise(r => setTimeout(r, 500));
            await testPasswordValidation();
            await new Promise(r => setTimeout(r, 500));
            await testRequiredFields();
            await new Promise(r => setTimeout(r, 500));
            await testSQLInjection();
            await new Promise(r => setTimeout(r, 500));
            
            // Security Tests
            await testUnauthorizedAccess();
            await new Promise(r => setTimeout(r, 500));
            testPasswordHashing();
            await new Promise(r => setTimeout(r, 500));
            await testXSSPrevention();
            
            alert(`Testing Complete!\nTotal: ${testStats.total}\nPassed: ${testStats.passed}\nFailed: ${testStats.failed}`);
        }

        function clearResults() {
            document.querySelectorAll('.results').forEach(div => div.innerHTML = '');
            testStats = { total: 0, passed: 0, failed: 0, pending: 0 };
            updateStats();
        }

        // Initialize
        updateStats();
    </script>
</body>
</html>
